- id: '1620421870577'
  alias: Campanello
  description: ''
  triggers:
  - device_id: aae8f95cc446017405e89f29e72c5a67
    domain: zha
    type: remote_button_short_press
    subtype: remote_button_short_press
    trigger: device
  - device_id: aae8f95cc446017405e89f29e72c5a67
    domain: zha
    type: remote_button_double_press
    subtype: remote_button_double_press
    trigger: device
  - device_id: aae8f95cc446017405e89f29e72c5a67
    domain: zha
    type: remote_button_triple_press
    subtype: remote_button_triple_press
    trigger: device
  - device_id: aae8f95cc446017405e89f29e72c5a67
    domain: zha
    type: remote_button_quadruple_press
    subtype: remote_button_quadruple_press
    trigger: device
  actions:
  - data:
      message: C’è qualcuno alla porta
      title: Sperons
    action: notify.mobile_app_iphone_di_anna
  - action: notify.mobile_app_marco
    data:
      message: C’è qualcuno alla porta
      title: Sperons
  - target:
      entity_id: media_player.tutta_la_casa_2
    data:
      media:
        media_content_id: http://192.168.0.44:8123/media/local/campanello.mp3
        media_content_type: audio/mpeg
        metadata:
          title: campanello.mp3
          thumbnail:
          media_class: music
          children_media_class:
          navigateIds:
          - {}
          - media_content_type: app
            media_content_id: media-source://media_source
          browse_entity_id: media_player.tutta_la_casa_2
    action: media_player.play_media
  mode: queued
  max: 10
- id: '1620456318506'
  alias: Luci | Accendi Luci Cucina
  description: Se rilevato movimento, se premo pulsante Day mode, se torno a casa
  triggers:
  - type: motion
    device_id: cbe6c38b5ab253acccea76024477c8ac
    entity_id: b35ba22911ac7b1ddb758e2652eb4d5f
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: group.people
      state: home
    - condition: time
      after: 06:00:00
      before: '23:00:00'
    enabled: false
  actions:
  - metadata: {}
    data: {}
    target:
      device_id:
      - fc2387fc56801831ab71b7838c4cf84c
    action: switch.turn_on
  - metadata: {}
    data: {}
    target:
      device_id: 01847dfae94757a545e16858ecbfd02f
    action: light.turn_on
  mode: single
- id: '1620456850540'
  alias: Allarme | Spegni Luci
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: armed_away
  actions:
  - data: {}
    target:
      area_id:
      - 74e0ac055aaa480582d1e2e8de47d44f
      - 0b38320b105143c9bd0186c7e81c4bc5
      - 6ff3454502494386800f4195f39a87e5
      - 23a02a43e6704807afd46529c33782a2
      - bca5afb4b70e41509c939ae88bfcc3b6
      - f309bc4d6f52475fb40147100df36fc0
      - 0d9d024a94fd4d5792e28c31e8c0735a
      - 4741e1a446a04b939eb0c5dd5ddab0ca
      - 12582e3c185e4cdb99a4e3faa76da0e7
    action: light.turn_off
  - metadata: {}
    data: {}
    target:
      device_id:
      - 5389f20b140c36763154e9936568a53f
      - 01847dfae94757a545e16858ecbfd02f
      - fc2387fc56801831ab71b7838c4cf84c
      - e2507075e4d0c2a8f1b7706f57c81ab9
      - 1462245104f1a54f815d9a79ab349a18
    action: switch.turn_off
  mode: single
- id: '1620456940266'
  alias: Cleaning Lady | Activate
  description: ''
  trigger:
  - platform: time
    at: input_datetime.cleaning_lady_starttime
  condition: []
  action:
  - service: automation.trigger
    target:
      entity_id:
      - automation.bb8_increment_counter
    data:
      skip_condition: true
  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.cleaning_lady
    data: {}
  - delay:
      hours: 4
      minutes: 30
      seconds: 0
      milliseconds: 0
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.cleaning_lady
    data: {}
  mode: single
- id: '1620457001021'
  alias: Luci | Lampada Armadio Turn On
  trigger:
  - device_id: c96eb0574fb8946625ebb627fbdad8da
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_on
  condition:
  - condition: state
    entity_id: light.lampada_armadio_level_light_color_on_off
    state: 'off'
  action:
  - type: turn_on
    device_id: f5ac2dc4b859643e95b174ce8837b37f
    entity_id: a3253aec9f81b77e08aa6b89a6c05620
    domain: light
  mode: single
- id: '1620457098189'
  alias: Luci | Lampada Armadio Turn Off
  description: ''
  trigger:
  - device_id: c96eb0574fb8946625ebb627fbdad8da
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: turn_off
  condition:
  - condition: state
    entity_id: light.lampada_armadio_level_light_color_on_off
    state: 'on'
  action:
  - type: turn_off
    device_id: f5ac2dc4b859643e95b174ce8837b37f
    entity_id: a3253aec9f81b77e08aa6b89a6c05620
    domain: light
  mode: single
- id: '1620457264571'
  alias: Luci | Lampada Armadio Increase Brightness
  trigger:
  - device_id: c96eb0574fb8946625ebb627fbdad8da
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: dim_up
  condition:
  - condition: device
    type: is_on
    device_id: f5ac2dc4b859643e95b174ce8837b37f
    entity_id: a3253aec9f81b77e08aa6b89a6c05620
    domain: light
  action:
  - device_id: f5ac2dc4b859643e95b174ce8837b37f
    domain: light
    entity_id: a3253aec9f81b77e08aa6b89a6c05620
    type: brightness_increase
  mode: single
- id: '1620457456137'
  alias: Luci | Lampada Armadio Decrease Brightness
  description: ''
  trigger:
  - device_id: c96eb0574fb8946625ebb627fbdad8da
    domain: zha
    platform: device
    type: remote_button_short_press
    subtype: dim_down
  condition:
  - condition: state
    entity_id: light.lampada_armadio_level_light_color_on_off
    state: 'on'
  action:
  - device_id: f5ac2dc4b859643e95b174ce8837b37f
    domain: light
    entity_id: a3253aec9f81b77e08aa6b89a6c05620
    type: brightness_decrease
  mode: single
- id: '1620457563888'
  alias: Luci | Turn on Balcony Light if I open the window after sunset
  description: ''
  triggers:
  - entity_id: binary_sensor.finestre_salotto
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: and
    conditions:
    - after: sunset
      condition: sun
    - condition: state
      entity_id: alarm_control_panel.allarme
      state: disarmed
  actions:
  - type: turn_on
    device_id: 9430035a10748db5731f472b716a2e7b
    entity_id: 74ef1f6c80064658dbaca190138b3495
    domain: light
  - wait_for_trigger:
    - entity_id:
      - binary_sensor.finestre_salotto
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 5
        seconds: 0
      trigger: state
  - type: turn_off
    device_id: 9430035a10748db5731f472b716a2e7b
    entity_id: 74ef1f6c80064658dbaca190138b3495
    domain: light
  mode: single
- id: '1620460795683'
  alias: BB8 | Increment Counter
  trigger:
  - platform: device
    device_id: 76673438b5732fc9582267751c361616
    domain: vacuum
    entity_id: f7d0660f82ec6ef6ebe32ef3f55a39b7
    type: docked
  action:
  - service: counter.increment
    data:
      entity_id: counter.daily_vacuum
  mode: single
- id: '1620460979885'
  alias: Cleaning Lady | Daily Reset
  trigger:
  - platform: state
    entity_id: group.people
    from: not_home
    to: home
  condition:
  - condition: state
    entity_id: input_boolean.cleaning_lady
    state: 'on'
  action:
  - service: input_boolean.turn_off
    entity_id: input_boolean.cleaning_lady
- id: '1620461097047'
  alias: Allarme | Arm after Cleaning Lady
  triggers:
  - entity_id: input_boolean.cleaning_lady
    from: 'on'
    to: 'off'
    trigger: state
  conditions:
  - condition: state
    entity_id: group.people
    state: not_home
  actions:
  - action: alarm_control_panel.alarm_arm_away
    metadata: {}
    data:
      code: '1720'
    target:
      entity_id: alarm_control_panel.allarme
  - action: alarm_control_panel.alarm_arm_away
    metadata: {}
    data:
      code: '0305'
    target:
      device_id: d18761e2c05c4192c503c32a23648d6d
  mode: single
- id: '1620461148824'
  alias: Allarme | Disarm
  description: ''
  triggers:
  - entity_id: group.people
    from: not_home
    to: home
    trigger: state
  - entity_id: input_boolean.holiday
    from: 'on'
    to: 'off'
    trigger: state
  - entity_id: input_boolean.cleaning_lady
    from: 'off'
    to: 'on'
    trigger: state
  - device_id: 57917b794ef6f9fb6a78dcff3db83a4e
    domain: homekit_controller
    type: button1
    subtype: single_press
    trigger: device
  - device_id: 1daf06196dc126183339cb1039d8484d
    domain: lock
    entity_id: ad13c671c49babd8823604b92886cc7b
    type: unlocking
    trigger: device
  actions:
  - action: alarm_control_panel.alarm_disarm
    metadata: {}
    data:
      code: '0305'
    target:
      device_id: d18761e2c05c4192c503c32a23648d6d
  - action: alarm_control_panel.alarm_disarm
    metadata: {}
    data:
      code: '1720'
    target:
      entity_id: alarm_control_panel.allarme
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: true
    target:
      entity_id: automation.temperatura_workday_warm_mode
  mode: single
- id: '1620461396451'
  alias: Allarme | Send alert armed away
  triggers:
  - entity_id:
    - binary_sensor.porta_e_finestre
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: state
    entity_id: alarm_control_panel.allarme
    state: armed_away
  actions:
  - action: notify.mobile_app_marco
    metadata: {}
    data:
      message: Qualcuno ha aperto una porta o finestra
      title: Sperons
  - action: notify.mobile_app_iphone_di_anna
    metadata: {}
    data:
      message: Qualcuno ha aperto una porta o finestra
      title: Sperons
  - action: script.allarme_suona_sirena_in_tutta_la_casa
    metadata: {}
    data: {}
  mode: single
- id: '1620461480038'
  alias: Lavastoviglie | Alert perde acqua
  description: ''
  trigger:
  - type: moist
    platform: device
    device_id: d08c58969593cfb31f366f85b243d549
    entity_id: e26d8df6d4b2a621d58f69070d1005b7
    domain: binary_sensor
  condition: []
  action:
  - action: notify.mobile_app_iphone_14pro
    data:
      data: ALLARME | La lavastoviglie perde acqua
      message: Sperons
  - action: notify.mobile_app_iphone_di_anna
    data:
      data: ALLARME | La lavastoviglie perde acqua
      message: Sperons
  mode: single
- id: '1620461571597'
  alias: Lavastoviglie | Spegni se perde acqua
  description: ''
  triggers:
  - type: moist
    device_id: d08c58969593cfb31f366f85b243d549
    entity_id: e26d8df6d4b2a621d58f69070d1005b7
    domain: binary_sensor
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: device
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: alarm_control_panel.allarme
      state: armed_away
    - condition: state
      entity_id: alarm_control_panel.allarme
      state: arming
  actions:
  - type: turn_off
    device_id: 2e739117bc860635d24f230e307843e4
    entity_id: 5c64e501e19ae3faeace1ffb638c0e98
    domain: switch
  - data:
      title: Sperons
      message: L'ho spenta
      data:
        subtitle: ALLARME | La lavastoviglie perde acqua
    action: notify.mobile_app_iphone_14pro
  - data:
      title: Sperons
      message: L'ho spenta
      data:
        subtitle: ALLARME | La lavastoviglie perde acqua
    action: notify.mobile_app_iphone_di_anna
  mode: single
- id: '1620461665694'
  alias: Lavatrice | Alert perde acqua
  description: ''
  triggers:
  - type: moist
    device_id: 1b8a3e096e3e140928cfc9fa6bd80141
    entity_id: 13029739ced99dd1ffa54e95af7619ed
    domain: binary_sensor
    trigger: device
  conditions: []
  actions:
  - action: notify.mobile_app_marco
    data:
      message: Controllala
      title: Sperons
      data:
        subtitle: ALLARME | La lavatrice perde acqua
  - data:
      message: Controllala
      title: Sperons
      data:
        subtitle: ALLARME | La lavatrice perde acqua
    action: notify.mobile_app_iphone_di_anna
  mode: single
- id: '1620461721759'
  alias: Lavatrice | Spegni se perde acqua
  description: ''
  triggers:
  - type: moist
    device_id: 1b8a3e096e3e140928cfc9fa6bd80141
    entity_id: 13029739ced99dd1ffa54e95af7619ed
    domain: binary_sensor
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: device
  conditions:
  - condition: or
    conditions:
    - condition: state
      entity_id: alarm_control_panel.allarme
      state: armed_away
    - condition: state
      entity_id: alarm_control_panel.allarme
      state: arming
  actions:
  - type: turn_off
    device_id: 12de3d48188784b200562407cfe514f0
    entity_id: 7e9abbe6c3a81125ea4cc97257443d78
    domain: switch
  - type: turn_off
    device_id: 5d93d6fc2c3cc1025f4422859e906e92
    entity_id: 97cfd66961f5c87e37acc51c2109d154
    domain: switch
  - action: notify.mobile_app_iphone_14pro
    data:
      data: ALLARME | La lavastoviglie perde acqua
      message: Sperons
  - data:
      title: Sperons
      message: L'ho spenta
      data:
        subtitle: ALLARME | La lavatrice perde acqua
    action: notify.mobile_app_iphone_di_anna
  mode: single
- id: '1620462111383'
  alias: Allarme | Hai lasciato la finestra aperta
  triggers:
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: armed_away
  conditions:
  - condition: state
    state: 'on'
    entity_id: binary_sensor.porta_e_finestre
  actions:
  - action: notify.mobile_app_iphone_di_anna
    metadata: {}
    data:
      message: Stai lasciando una finestra aperta
      title: Sperons
  - action: notify.mobile_app_marco
    metadata: {}
    data:
      message: Stai lasciando una finestra aperta
      title: Sperons
- id: '1620545242805'
  alias: Scrivania | Turn On
  description: Accendi se c’è qualcuno in stanza per 5 minuti
  triggers:
  - type: occupied
    device_id: 2e52b92b61c0a1c3a95f3b92659257a2
    entity_id: 649d21c9f51a0a2244742106dc05ea55
    domain: binary_sensor
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: device
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: group.people
      state: home
    - condition: time
      after: 08:00:00
      before: '20:00:00'
      weekday:
      - sun
      - mon
      - tue
      - wed
      - thu
      - fri
      - sat
  actions:
  - type: turn_on
    device_id: e2507075e4d0c2a8f1b7706f57c81ab9
    entity_id: 34162cdad109b1302f8e491840613bb0
    domain: switch
  mode: single
- id: '1620553921724'
  alias: BB8 | Reset counter
  description: ''
  trigger:
  - platform: time
    at: '23:59:00'
  condition:
  - condition: state
    entity_id: input_boolean.holiday
    state: 'off'
  action:
  - service: counter.reset
    target:
      entity_id: counter.daily_vacuum
    data: {}
  mode: single
- id: '1620716872312'
  alias: Setup | Attiva Caloriferi
  triggers:
  - entity_id: binary_sensor.riscaldamento
    from: 'off'
    to: 'on'
    trigger: state
  actions:
  - action: automation.turn_on
    metadata: {}
    data: {}
    target:
      label_id: caloriferi
  mode: queued
  max: 10
- id: '1620717037800'
  alias: Setup | Disattiva Caloriferi
  triggers:
  - entity_id: binary_sensor.riscaldamento
    from: 'on'
    to: 'off'
    trigger: state
  actions:
  - action: automation.turn_off
    metadata: {}
    data:
      stop_actions: true
    target:
      label_id: caloriferi
  mode: queued
  max: 10
- id: '1620718048135'
  alias: Temperatura | Camera Bambine | Eco Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.finestra_camera_bambine
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - input_boolean.holiday
    to: 'on'
  - trigger: state
    entity_id:
    - input_boolean.cleaning_lady
    to: 'on'
  actions:
  - action: climate.set_hvac_mode
    metadata: {}
    data:
      hvac_mode: 'off'
    target:
      device_id:
      - 80a74cd635b62addd022a3239f1ee041
  mode: queued
  max: 10
- id: '1620718250243'
  alias: Temperatura | Bagno di Servizio | Eco Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.finestra_bagno_di_servizio
    to:
    - 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - input_boolean.holiday
    to: 'on'
  - trigger: state
    entity_id:
    - input_boolean.cleaning_lady
    to: 'on'
  actions:
  - action: climate.set_hvac_mode
    metadata: {}
    data:
      hvac_mode: 'off'
    target:
      area_id: 6ff3454502494386800f4195f39a87e5
  mode: queued
  max: 10
- id: '1627220397134'
  alias: Forno | Spegni quando Vacanza ON
  description: ''
  triggers:
  - entity_id:
    - input_boolean.holiday
    from: 'off'
    trigger: state
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  conditions: []
  actions:
  - type: turn_off
    device_id: c633058d90b2f41f1d4786df78d1969c
    entity_id: d974ef70b7826371fc7d9a49a456a9f6
    domain: switch
  mode: single
- id: '1629822147050'
  alias: Condizionatore | Finestra Aperta | Zona Giorno
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.finestre_zona_giorno
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
    to: 'on'
    trigger: state
  conditions:
  - condition: not
    conditions:
    - condition: device
      device_id: 3a08356455069bcd013a8073bde73d59
      domain: climate
      entity_id: 1557890387d39325bafdd527dd4dbb62
      type: is_hvac_mode
      hvac_mode: 'off'
  actions:
  - device_id: 3a08356455069bcd013a8073bde73d59
    domain: climate
    entity_id: 1557890387d39325bafdd527dd4dbb62
    type: set_hvac_mode
    hvac_mode: 'off'
  mode: single
- id: '1629822332364'
  alias: Condizionatore | Finestra Aperta | Camera da Letto
  description: ''
  triggers:
  - type: opened
    device_id: d61561c1b1ada64657e53aa2565a2e23
    entity_id: 61b943dc3098da6ab3d56d6f79ba1f83
    domain: binary_sensor
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: device
  conditions:
  - condition: not
    conditions:
    - condition: device
      device_id: baac0bbae3e5bd4dfee3d472de1fcccb
      domain: climate
      entity_id: aaa4d9a34e9724359be0c3516e232be5
      type: is_hvac_mode
      hvac_mode: 'off'
  actions:
  - device_id: baac0bbae3e5bd4dfee3d472de1fcccb
    domain: climate
    entity_id: aaa4d9a34e9724359be0c3516e232be5
    type: set_hvac_mode
    hvac_mode: 'off'
  mode: single
- id: '1629822474599'
  alias: Condizionatore | Finestra Aperta | Camera Bambine
  description: ''
  triggers:
  - type: opened
    device_id: 591c88f3f1581c1b0d753cb3fefa3bf1
    entity_id: cb2bc219a3fd841e7403a23868576290
    domain: binary_sensor
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: device
  conditions:
  - condition: not
    conditions:
    - condition: device
      device_id: 04d9bd175a50efc953575388736c2cd7
      domain: climate
      entity_id: 3a673fb1c392b67e73c0acc24cc67006
      type: is_hvac_mode
      hvac_mode: 'off'
  actions:
  - device_id: 04d9bd175a50efc953575388736c2cd7
    domain: climate
    entity_id: 3a673fb1c392b67e73c0acc24cc67006
    type: set_hvac_mode
    hvac_mode: 'off'
  mode: single
- id: '1629822527635'
  alias: Condizionatore | Finestra Aperta | Studio
  description: ''
  triggers:
  - type: opened
    device_id: 5f16ae17e625ea487fd9ebdb485be83d
    entity_id: 0322d8ccc1348a57da2ddb1f4e7d4ed8
    domain: binary_sensor
    for:
      hours: 0
      minutes: 5
      seconds: 0
    trigger: device
  conditions:
  - condition: not
    conditions:
    - condition: device
      device_id: 65e157223dd4cd8f233dac9b13d62672
      domain: climate
      entity_id: 7be03bf0e41b5d2770141961a33f9e11
      type: is_hvac_mode
      hvac_mode: 'off'
  actions:
  - device_id: 65e157223dd4cd8f233dac9b13d62672
    domain: climate
    entity_id: 7be03bf0e41b5d2770141961a33f9e11
    type: set_hvac_mode
    hvac_mode: 'off'
  mode: single
- id: '1634981179197'
  alias: Temperatura | Camera Bambine | Temperatura bassa
  description: ''
  triggers:
  - entity_id:
    - sensor.ble_temperature_temperatura_camera_bambine
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
    below: 19.9
    trigger: numeric_state
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.holiday
      state: 'off'
    - condition: state
      entity_id: alarm_control_panel.allarme
      state: disarmed
    - type: is_not_open
      condition: device
      device_id: 591c88f3f1581c1b0d753cb3fefa3bf1
      entity_id: cb2bc219a3fd841e7403a23868576290
      domain: binary_sensor
  actions:
  - action: notify.mobile_app_iphone_di_anna
    metadata: {}
    data:
      message: Camera bambine temperatura bassa
      title: Sperons
  - action: notify.mobile_app_marco
    metadata: {}
    data:
      message: Camera bambine temperatura bassa
      title: Sperons
  mode: single
- id: '1634981552369'
  alias: Temperatura | Camera Bambine | Umidità bassa
  description: ''
  triggers:
  - for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
    entity_id:
    - sensor.ble_humidity_temperatura_camera_bambine
    below: '45'
    trigger: numeric_state
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.holiday
      state: 'off'
    - condition: state
      entity_id: alarm_control_panel.allarme
      state: disarmed
    - type: is_not_open
      condition: device
      device_id: 591c88f3f1581c1b0d753cb3fefa3bf1
      entity_id: cb2bc219a3fd841e7403a23868576290
      domain: binary_sensor
  actions:
  - action: notify.mobile_app_iphone_di_anna
    metadata: {}
    data:
      message: Camera bambine umidità bassa
      title: Sperons
  - action: notify.mobile_app_marco
    metadata: {}
    data:
      message: Camera bambine umidità bassa
      title: Sperons
  mode: single
- id: '1635109380228'
  alias: Allarme | Hai lasciato la porta aperta
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: armed_away
  conditions:
  - type: is_open
    condition: device
    device_id: e3cb4d185c2a20a48fe86927b86fec7f
    entity_id: 179e602e6f41506d3e5247b2b8cd9332
    domain: binary_sensor
  actions:
  - action: notify.mobile_app_iphone_di_anna
    metadata: {}
    data:
      message: Hai lasciato la porta aperta
      title: Sperons
  - action: notify.mobile_app_marco
    metadata: {}
    data:
      message: Hai lasciato la porta aperta
      title: Sperons
  mode: single
- id: '1639823167889'
  alias: Luci di Natale | Turn Off
  description: ''
  triggers:
  - at: 00:00
    enabled: true
    trigger: time
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: armed_away
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: device_tracker.albero_di_natale
      state:
      - home
    - condition: device
      type: is_on
      device_id: 77eab15b63cc0ac50aaaa591095f387f
      entity_id: a62550fc2b297d8380f9d06fd2079d2e
      domain: switch
  actions:
  - action: switch.turn_off
    metadata: {}
    data: {}
    target:
      device_id:
      - 77eab15b63cc0ac50aaaa591095f387f
  mode: single
- id: '1643016750304'
  alias: Luci | The Sub On
  description: Se The Sub acceso non spegnere Angolo
  triggers:
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: arming
  conditions:
  - condition: state
    entity_id: input_boolean.the_sub
    state: 'on'
  actions:
  - type: turn_on
    device_id: 5389f20b140c36763154e9936568a53f
    entity_id: d5cb620718715d87abb8e4a9ab5d56d8
    domain: switch
  mode: single
- id: '1648982551833'
  alias: Temperatura | Spegni Caloriferi
  description: ''
  triggers:
  - at: '23:59:59'
    trigger: time
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: arming
  conditions: []
  actions:
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: true
    target:
      label_id: eco_mode
  mode: single
- id: '1648983128840'
  alias: Temperatura | Weekend | Warm Mode
  description: ''
  triggers:
  - at: 07:00
    trigger: time
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: group.people
      state: home
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'off'
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.finestra_bagno_di_servizio
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_bagno_di_servizio_finestra_chiusa
  - if:
    - condition: state
      entity_id: binary_sensor.finestra_bagno_padronale
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_bagno_padronale_finestra_chiusa
  - if:
    - condition: state
      entity_id: binary_sensor.finestra_camera_bambine
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_camera_bambine_finestra_chiusa
  - if:
    - condition: state
      entity_id: binary_sensor.finestra_camera_da_letto
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_camera_matrimoniale_finestra_chiusa
  - if:
    - condition: state
      entity_id: binary_sensor.finestra_studio
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_studio_warm_mode
  - if:
    - condition: state
      entity_id: binary_sensor.finestre_zona_giorno
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_zona_giorno_warm_mode
  mode: queued
  max: 10
- id: '1648983498528'
  alias: Temperatura | Studio | Eco Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.finestra_studio
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - input_boolean.holiday
    to: 'on'
  - trigger: state
    entity_id:
    - input_boolean.cleaning_lady
    to: 'on'
  conditions: []
  actions:
  - data:
      temperature: 4
    target:
      device_id: ba3585d6944421999760341e34949bb2
    action: climate.set_temperature
  mode: queued
  max: 10
- id: '1648985951150'
  alias: Temperatura | Bagno Padronale | Eco Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.finestra_bagno_padronale
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - input_boolean.holiday
    to: 'on'
  - trigger: state
    entity_id:
    - input_boolean.cleaning_lady
    to: 'on'
  conditions: []
  actions:
  - target:
      device_id: caa6a9c8e1d2b8ed8f758d34f2ac4488
    data:
      temperature: 4
    action: climate.set_temperature
  mode: queued
  max: 10
- id: '1648986149286'
  alias: Temperatura | Zona Giorno | Eco Mode
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.finestre_zona_giorno
    for:
      hours: 0
      minutes: 5
      seconds: 0
    to: 'on'
    trigger: state
  - trigger: state
    entity_id:
    - input_boolean.holiday
    to: 'on'
  - trigger: state
    entity_id:
    - input_boolean.cleaning_lady
    to: 'on'
  conditions: []
  actions:
  - data:
      temperature: 4
    target:
      device_id:
      - 1543db44fffa26ecbd2501f888bd069f
      - 87a22287aecd7588d3917e8a0b6ad74b
    action: climate.set_temperature
  mode: queued
  max: 10
- id: '1648990136054'
  alias: Temperatura | Camera Matrimoniale | Eco Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.finestra_camera_da_letto
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
  - trigger: state
    entity_id:
    - input_boolean.holiday
    to: 'on'
  - trigger: state
    entity_id:
    - input_boolean.cleaning_lady
    to: 'on'
  conditions: []
  actions:
  - data:
      temperature: 4
    target:
      device_id: 1612b639fa2be576fabaa53bdbdac59f
    action: climate.set_temperature
  mode: queued
  max: 10
- id: '1657955018954'
  alias: BB8 | Pulisci in Vacanza
  description: ''
  triggers:
  - at: 09:00:00
    trigger: time
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.holiday
      state: 'on'
    - condition: time
      weekday:
      - sun
      - wed
      - fri
      - mon
  actions:
  - data: {}
    target:
      entity_id: counter.daily_vacuum
    action: counter.reset
  - action: vacuum.start
    metadata: {}
    data: {}
    target:
      device_id: 76673438b5732fc9582267751c361616
  mode: single
- id: '1689448378492'
  alias: Air Purifier Salotto | Turn on if PM 2.5 above 12
  description: ''
  triggers:
  - entity_id:
    - sensor.air_purifier_zona_giorno_pm2_5
    for:
      hours: 0
      minutes: 30
      seconds: 0
    above: 12
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: group.people
    state: home
  - condition: state
    entity_id: binary_sensor.finestre_zona_giorno
    state: 'off'
  actions:
  - type: turn_on
    device_id: 0d2e0717468cfad163af25cb518c421f
    entity_id: b6de69964b3d84dd2908af643f854803
    domain: fan
  mode: single
- id: '1689448546001'
  alias: Air Purifier Salotto | Turn Off
  description: Se usciamo di casa, se premo night mode
  triggers:
  - entity_id:
    - sensor.air_purifier_zona_giorno_pm2_5
    for:
      hours: 0
      minutes: 30
      seconds: 0
    below: 9
    trigger: numeric_state
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: arming
  conditions: []
  actions:
  - type: turn_off
    device_id: 0d2e0717468cfad163af25cb518c421f
    entity_id: b6de69964b3d84dd2908af643f854803
    domain: fan
  mode: single
- id: '1689628098081'
  alias: Air Purifier Salotto | Spegni se finestra aperta
  description: Riaccendi dopo 1 minuto
  trigger:
  - platform: state
    entity_id: binary_sensor.finestre_zona_giorno
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
  condition:
  - condition: device
    device_id: 0d2e0717468cfad163af25cb518c421f
    domain: fan
    entity_id: b6de69964b3d84dd2908af643f854803
    type: is_on
  action:
  - type: turn_off
    device_id: 0d2e0717468cfad163af25cb518c421f
    entity_id: b6de69964b3d84dd2908af643f854803
    domain: fan
  mode: queued
  max: 10
- id: '1705696815077'
  alias: Allarme | Attiva sirena se apro porta
  description: ''
  triggers:
  - type: opened
    device_id: e3cb4d185c2a20a48fe86927b86fec7f
    entity_id: 179e602e6f41506d3e5247b2b8cd9332
    domain: binary_sensor
    trigger: device
  conditions:
  - condition: state
    entity_id: alarm_control_panel.allarme
    state: armed_away
  actions:
  - device_id: 8a0d43577df199a2440b353df0da96d2
    domain: mobile_app
    type: notify
    message: La porta è stata aperta
    title: Allarme
  - device_id: 3e8d3c4f328c54f070cac80889499d2d
    domain: mobile_app
    type: notify
    message: La porta è stata aperta
    title: Allarme
  - target:
      entity_id: media_player.tutta_la_casa_2
    data:
      media_content_id: http://192.168.0.44:8123/media/local/sirena.mp3
      media_content_type: audio/mp3
    action: media_player.play_media
  - repeat:
      sequence:
      - target:
          entity_id: media_player.tutta_la_casa_2
        data:
          media_content_id: http://192.168.0.44:8123/media/local/sirena.mp3
          media_content_type: audio/mp3
        action: media_player.play_media
      while:
      - condition: state
        entity_id: alarm_control_panel.allarme
        state: triggered
  mode: single
- id: '1707943144465'
  alias: Luci | Spegni Cucina se nessun movimento
  description: ''
  triggers:
  - type: not_occupied
    device_id: cbe6c38b5ab253acccea76024477c8ac
    entity_id: 65194f388168c176fb0b50e49bd881d3
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 0
    trigger: device
  conditions: []
  actions:
  - metadata: {}
    data: {}
    target:
      area_id:
      - f309bc4d6f52475fb40147100df36fc0
      - 0d9d024a94fd4d5792e28c31e8c0735a
    action: light.turn_off
  mode: single
- id: '1708764461789'
  alias: Luci | Spegni Salotto se nessun movimento
  description: ''
  trigger:
  - type: not_occupied
    platform: device
    device_id: 2c72f52a91a6e88f9bfd44446a03036b
    entity_id: 65e210f4d2343847e035775c267a233e
    domain: binary_sensor
    for:
      hours: 0
      minutes: 0
      seconds: 0
  condition: []
  action:
  - metadata: {}
    data: {}
    target:
      device_id: 5389f20b140c36763154e9936568a53f
    action: switch.turn_off
  - metadata: {}
    data: {}
    target:
      area_id:
      - 4741e1a446a04b939eb0c5dd5ddab0ca
      - 0d9d024a94fd4d5792e28c31e8c0735a
    action: light.turn_off
  mode: single
- id: '1710596207507'
  alias: Air Purifier Bambine | Turn On if PM2.5 higher then 12
  description: ''
  triggers:
  - entity_id:
    - sensor.air_purifier_cameretta_pm2_5
    for:
      hours: 0
      minutes: 30
      seconds: 0
    above: 12
    trigger: numeric_state
  conditions:
  - condition: state
    entity_id: group.people
    state: home
  - condition: state
    state: 'off'
    entity_id: binary_sensor.finestra_camera_bambine
  actions:
  - type: turn_on
    device_id: ccb2e11f57860e721ef36e5b7d895b91
    entity_id: 9fd3dd73529c18b2a5cc9f925fc723a7
    domain: fan
  mode: single
- id: '1710596277788'
  alias: Air Purifier Bambine | Turn Off se finestra aperta
  description: Riaccendi dopo 1 minuto
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.finestra_camera_bambine
    to: 'on'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    from: 'off'
  condition:
  - condition: device
    device_id: ccb2e11f57860e721ef36e5b7d895b91
    domain: fan
    entity_id: 9fd3dd73529c18b2a5cc9f925fc723a7
    type: is_on
  action:
  - type: turn_off
    device_id: ccb2e11f57860e721ef36e5b7d895b91
    entity_id: 9fd3dd73529c18b2a5cc9f925fc723a7
    domain: fan
  mode: queued
  max: 10
- id: '1712048401075'
  alias: Luci | Spegni tutto se nessun movimento in Bagno Padronale
  description: ''
  trigger:
  - type: no_motion
    platform: device
    device_id: 92a9e4f60780ecd6ac64082d0b845bde
    entity_id: 73773271ccef453c311446ea676e30c8
    domain: binary_sensor
    for:
      hours: 0
      minutes: 10
      seconds: 0
  condition:
  - condition: device
    type: is_on
    device_id: 0b4529ac69ba47f2939d22231308696f
    entity_id: bcf11309c1fe17c724c17d53bb7f4faa
    domain: light
  action:
  - service: light.turn_off
    metadata: {}
    data: {}
    target:
      area_id: 0b38320b105143c9bd0186c7e81c4bc5
  mode: single
- id: '1715689049928'
  alias: BB8 | Start Cleaning
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: armed_away
  conditions:
  - condition: and
    conditions:
    - condition: or
      conditions:
      - condition: time
        after: 08:00:00
        before: '20:00:00'
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
      - condition: time
        weekday:
        - sun
        - sat
        after: 09:00:00
        before: '20:00:00'
    - condition: numeric_state
      entity_id: counter.daily_vacuum
      below: 1
  actions:
  - action: vacuum.start
    metadata: {}
    data: {}
    target:
      device_id: 76673438b5732fc9582267751c361616
  mode: single
- id: '1724675797749'
  alias: Condizionatore | Spegni se attivo allarme
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: arming
  conditions: []
  actions:
  - action: climate.set_hvac_mode
    metadata: {}
    data:
      hvac_mode: 'off'
    target:
      device_id:
      - baac0bbae3e5bd4dfee3d472de1fcccb
      - 3a08356455069bcd013a8073bde73d59
      - 65e157223dd4cd8f233dac9b13d62672
      - 04d9bd175a50efc953575388736c2cd7
  mode: single
- id: '1728542039625'
  alias: Allarme | Chiudi porta quando stai attivando allarme
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: armed_away
  - type: not_opened
    device_id: e3cb4d185c2a20a48fe86927b86fec7f
    entity_id: 179e602e6f41506d3e5247b2b8cd9332
    domain: binary_sensor
    trigger: device
    for:
      hours: 0
      minutes: 5
      seconds: 0
  conditions:
  - condition: device
    device_id: 1daf06196dc126183339cb1039d8484d
    domain: lock
    entity_id: ad13c671c49babd8823604b92886cc7b
    type: is_unlocked
  actions:
  - device_id: 1daf06196dc126183339cb1039d8484d
    domain: lock
    entity_id: ad13c671c49babd8823604b92886cc7b
    type: lock
  mode: single
- id: '1733060317264'
  alias: Luci di Natale | Turn On when return home
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to:
    - disarmed
  conditions:
  - condition: state
    entity_id: device_tracker.albero_di_natale
    state:
    - home
  actions:
  - action: switch.turn_on
    metadata: {}
    data: {}
    target:
      device_id:
      - 77eab15b63cc0ac50aaaa591095f387f
  mode: single
- id: '1734164587606'
  alias: Scrivania | Turn Off
  description: ''
  triggers:
  - type: not_occupied
    device_id: 2e52b92b61c0a1c3a95f3b92659257a2
    entity_id: 649d21c9f51a0a2244742106dc05ea55
    domain: binary_sensor
    trigger: device
    for:
      hours: 0
      minutes: 5
      seconds: 0
  conditions: []
  actions:
  - type: turn_off
    device_id: e2507075e4d0c2a8f1b7706f57c81ab9
    entity_id: 34162cdad109b1302f8e491840613bb0
    domain: switch
  mode: single
- id: '1734202278457'
  alias: Air Purifier Bambine | Turn Off
  description: Se usciamo di casa, se premo night mode
  triggers:
  - entity_id:
    - sensor.air_purifier_cameretta_pm2_5
    for:
      hours: 0
      minutes: 30
      seconds: 0
    below: 9
    trigger: numeric_state
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: arming
  conditions: []
  actions:
  - type: turn_off
    device_id: ccb2e11f57860e721ef36e5b7d895b91
    entity_id: 9fd3dd73529c18b2a5cc9f925fc723a7
    domain: fan
  mode: single
- id: '1734807261908'
  alias: Luci di Natale | Turn On after sunser
  description: ''
  triggers:
  - trigger: sun
    event: sunset
    offset: 0
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: group.people
      state: home
    - condition: state
      entity_id: device_tracker.albero_di_natale
      state:
      - home
    - condition: device
      type: is_off
      device_id: 77eab15b63cc0ac50aaaa591095f387f
      entity_id: a62550fc2b297d8380f9d06fd2079d2e
      domain: switch
  actions:
  - action: switch.turn_on
    metadata: {}
    data: {}
    target:
      device_id:
      - 77eab15b63cc0ac50aaaa591095f387f
  mode: single
- id: '1736026101338'
  alias: Allarme | Blink + AI (semplice)
  triggers:
  - entity_id: alarm_control_panel.allarme
    to: armed_away
    trigger: state
  actions:
  - repeat:
      while:
      - condition: state
        entity_id: alarm_control_panel.allarme
        state: armed_away
      sequence:
      - action: script.ai_check_ingresso_blink
        data: {}
      - action: script.ai_check_image_notify
        data: {}
      - delay:
          minutes: 5
  mode: single
- id: '1739263906081'
  alias: Air Purifier Bambine | Alert qualità dell'aria
  description: ''
  triggers:
  - entity_id:
    - sensor.air_purifier_cameretta_pm2_5
    above: 15
    for:
      hours: 0
      minutes: 30
      seconds: 0
    trigger: numeric_state
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.holiday
      state: 'off'
    - condition: state
      entity_id: alarm_control_panel.allarme
      state: disarmed
    - type: is_not_open
      condition: device
      device_id: 591c88f3f1581c1b0d753cb3fefa3bf1
      entity_id: cb2bc219a3fd841e7403a23868576290
      domain: binary_sensor
  actions:
  - action: notify.mobile_app_iphone_di_anna
    metadata: {}
    data:
      message: Camera bambine qualità dell'aria inadeguata
      title: Sperons
  - action: notify.mobile_app_marco
    metadata: {}
    data:
      message: Camera bambine qualità dell'aria inadeguata
      title: Sperons
  mode: single
- id: '1741532815181'
  alias: Lavatrice | Spegni se finito ciclo da 1 ora
  description: ''
  triggers:
  - type: turned_off
    device_id: 12de3d48188784b200562407cfe514f0
    entity_id: 7e9abbe6c3a81125ea4cc97257443d78
    domain: switch
    trigger: device
    for:
      hours: 1
      minutes: 0
      seconds: 0
  conditions: []
  actions:
  - type: turn_off
    device_id: 5d93d6fc2c3cc1025f4422859e906e92
    entity_id: 97cfd66961f5c87e37acc51c2109d154
    domain: switch
  mode: single
- id: '1742850667371'
  alias: Temperatura | Bagno di Servizio | Warm Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.finestra_bagno_di_servizio
    to: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 0
  conditions:
  - condition: or
    conditions:
    - condition: time
      after: 06:00:00
      before: 09:00:00
    - condition: time
      after: '17:00:00'
  actions:
  - action: climate.set_hvac_mode
    metadata: {}
    data:
      hvac_mode: heat
    target:
      device_id: 478822d2f50cc837cc358c1a3073c903
  - action: climate.set_temperature
    metadata: {}
    data:
      temperature: 23
    target:
      device_id: 478822d2f50cc837cc358c1a3073c903
  mode: queued
  max: 10
- id: '1742850815107'
  alias: Temperatura | Bagno Padronale | Warm Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.finestra_bagno_padronale
    to: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 0
  conditions:
  - condition: or
    conditions:
    - condition: time
      after: 06:00:00
      before: 09:00:00
    - condition: time
      after: '16:00:00'
  actions:
  - target:
      device_id: caa6a9c8e1d2b8ed8f758d34f2ac4488
    data:
      temperature: 21
    action: climate.set_temperature
  mode: queued
  max: 10
- id: '1742850994498'
  alias: Temperatura | Camera Bambine | Umidità elevata
  description: ''
  triggers:
  - for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
    entity_id:
    - sensor.ble_humidity_temperatura_camera_bambine
    above: '70'
    trigger: numeric_state
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.holiday
      state: 'off'
    - condition: state
      entity_id: alarm_control_panel.allarme
      state: disarmed
    - type: is_not_open
      condition: device
      device_id: 591c88f3f1581c1b0d753cb3fefa3bf1
      entity_id: cb2bc219a3fd841e7403a23868576290
      domain: binary_sensor
  actions:
  - action: notify.mobile_app_iphone_di_anna
    metadata: {}
    data:
      message: Camera bambine umidità elevata
      title: Sperons
  - action: notify.mobile_app_marco
    metadata: {}
    data:
      message: Camera bambine umidità elevata
      title: Sperons
  mode: single
- id: '1742851076165'
  alias: Temperatura | Camera Bambine | Temperatura elevata
  description: ''
  triggers:
  - entity_id:
    - sensor.ble_temperature_temperatura_camera_bambine
    above: '24'
    for:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
    trigger: numeric_state
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: input_boolean.holiday
      state: 'off'
    - condition: state
      entity_id: alarm_control_panel.allarme
      state: disarmed
    - type: is_not_open
      condition: device
      device_id: 591c88f3f1581c1b0d753cb3fefa3bf1
      entity_id: cb2bc219a3fd841e7403a23868576290
      domain: binary_sensor
  actions:
  - action: notify.mobile_app_iphone_di_anna
    metadata: {}
    data:
      message: Camera bambine temperatura elevata
      title: Sperons
  - action: notify.mobile_app_marco
    metadata: {}
    data:
      message: Camera bambine temperatura elevata
      title: Sperons
  - action: automation.trigger
    metadata: {}
    data:
      skip_condition: true
    target:
      entity_id: automation.temperature_camera_bambine_finestra_aperta
  mode: single
- id: '1742851220457'
  alias: Temperatura | Camera Bambine | Warm Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.finestra_camera_bambine
    to: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 0
  conditions:
  - condition: or
    conditions:
    - condition: time
      after: 06:00:00
      before: 09:00:00
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    - condition: time
      after: '17:00:00'
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
    - condition: time
      weekday:
      - sun
      - sat
  actions:
  - action: climate.set_hvac_mode
    metadata: {}
    data:
      hvac_mode: heat
    target:
      device_id:
      - 80a74cd635b62addd022a3239f1ee041
  - action: climate.set_temperature
    metadata: {}
    data:
      temperature: 21
    target:
      device_id:
      - 80a74cd635b62addd022a3239f1ee041
  mode: queued
  max: 10
- id: '1742977647628'
  alias: Temperatura | Camera Matrimoniale | Warm Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.finestra_camera_da_letto
    to: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 0
  conditions:
  - condition: or
    conditions:
    - condition: time
      after: 06:00:00
      before: 09:00:00
    - condition: time
      after: '17:00:00'
  actions:
  - data:
      temperature: 21
    target:
      device_id: 1612b639fa2be576fabaa53bdbdac59f
    action: climate.set_temperature
  mode: queued
  max: 10
- id: '1742981721011'
  alias: Temperatura | Studio | Warm Mode
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.finestra_studio
    to: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 0
  conditions:
  - condition: or
    conditions:
    - condition: time
      after: 06:00:00
      before: 09:00:00
    - condition: time
      after: '17:00:00'
    - condition: state
      entity_id: input_boolean.smartworking
      state: 'on'
  actions:
  - data:
      temperature: 21
    target:
      device_id: ba3585d6944421999760341e34949bb2
    action: climate.set_temperature
  mode: queued
  max: 10
- id: '1742981882144'
  alias: Temperatura | Zona Giorno | Warm Mode
  description: ''
  triggers:
  - entity_id:
    - binary_sensor.finestre_zona_giorno
    for:
      hours: 0
      minutes: 1
      seconds: 0
    to: 'off'
    trigger: state
  conditions: []
  actions:
  - data:
      temperature: 21
    target:
      device_id:
      - 1543db44fffa26ecbd2501f888bd069f
    action: climate.set_temperature
  - data:
      temperature: 23
    target:
      device_id:
      - 87a22287aecd7588d3917e8a0b6ad74b
    action: climate.set_temperature
  mode: queued
  max: 10
- id: '1742982280264'
  alias: Temperatura | Workday | Warm Mode
  description: ''
  triggers:
  - at: 06:00:00
    trigger: time
  conditions:
  - condition: and
    conditions:
    - condition: state
      entity_id: group.people
      state: home
    - condition: state
      entity_id: binary_sensor.workday_sensor
      state: 'on'
  actions:
  - if:
    - condition: state
      entity_id: binary_sensor.finestra_bagno_di_servizio
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_bagno_di_servizio_finestra_chiusa
  - if:
    - condition: state
      entity_id: binary_sensor.finestra_bagno_padronale
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_bagno_padronale_finestra_chiusa
  - if:
    - condition: state
      entity_id: binary_sensor.finestra_camera_bambine
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_camera_bambine_finestra_chiusa
  - if:
    - condition: state
      entity_id: binary_sensor.finestra_camera_da_letto
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_camera_matrimoniale_finestra_chiusa
  - if:
    - condition: state
      entity_id: binary_sensor.finestra_studio
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_studio_warm_mode
  - if:
    - condition: state
      entity_id: binary_sensor.finestre_zona_giorno
      state: 'off'
    then:
    - action: automation.trigger
      metadata: {}
      data:
        skip_condition: true
      target:
        entity_id: automation.temperatura_zona_giorno_warm_mode
  mode: queued
  max: 10
- id: '1751053903437'
  alias: Allarme | Arm
  description: ''
  triggers:
  - entity_id:
    - group.people
    from: home
    to: not_home
    trigger: state
  - entity_id:
    - input_boolean.holiday
    from: 'off'
    to: 'on'
    trigger: state
  - entity_id:
    - input_boolean.cleaning_lady
    to: 'off'
    trigger: state
    from: 'on'
  - device_id: 57917b794ef6f9fb6a78dcff3db83a4e
    domain: homekit_controller
    type: button2
    subtype: single_press
    trigger: device
  conditions:
  - condition: state
    entity_id: input_boolean.cleaning_lady
    state:
    - 'off'
  actions:
  - action: alarm_control_panel.alarm_arm_away
    metadata: {}
    data:
      code: '1720'
    target:
      entity_id: alarm_control_panel.allarme
  - action: alarm_control_panel.alarm_arm_away
    metadata: {}
    data:
      code: '0305'
    target:
      device_id: d18761e2c05c4192c503c32a23648d6d
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.smartworking
    data: {}
  mode: single
- id: '1751227893314'
  alias: Smartworking | ON
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.smartworking
    to: 'on'
  conditions: []
  actions:
  - action: automation.turn_off
    metadata: {}
    data:
      stop_actions: true
    target:
      entity_id: automation.scrivania_turn_off
  mode: single
- id: '1752641951343'
  alias: Smartworking | OFF
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - input_boolean.smartworking
    to: 'off'
  conditions: []
  actions:
  - action: automation.turn_on
    target:
      entity_id: automation.scrivania_turn_off
    data: {}
  mode: single
- id: '1754241634778'
  alias: N8N | New Device
  description: ''
  triggers:
  - value_template: "{# elenco dei device_tracker \"sconosciuti\" già in casa #} {%
      set trusted = state_attr('group.dispositivi_trusted', 'entity_id') or [] %}
      {% set unknown_home = states.device_tracker\n     | selectattr('state', 'eq',
      'home')\n     | rejectattr('entity_id', 'in', trusted)\n     | list %}\n{{ unknown_home
      | length > 0 }}\n"
    trigger: template
  actions:
  - variables:
      new_dev: "{{ states.device_tracker\n     | selectattr('state','eq','home')\n
        \    | rejectattr('entity_id','in', (state_attr('group.dispositivi_trusted','entity_id')
        or []))\n     | list\n     | first }}"
  - data:
      name: '{{ new_dev.name or new_dev.attributes.friendly_name }}'
      mac: '{{ new_dev.attributes.mac | default(''N/D'') }}'
      ip: '{{ new_dev.attributes.ip | default(''N/D'') }}'
    action: rest_command.n8n_new_device
  - data:
      title: Nuovo dispositivo in rete
      message: 'Rilevato {{ new_dev.name }} (MAC {{ new_dev.attributes.mac }}) collegato
        all''IP {{ new_dev.attributes.ip }}.

        '
    action: persistent_notification.create
- id: '1755000448878'
  alias: Forno | Accendi quando Vacanza OFF
  description: ''
  triggers:
  - entity_id:
    - input_boolean.holiday
    from: 'on'
    trigger: state
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 0
  conditions: []
  actions:
  - type: turn_on
    device_id: c633058d90b2f41f1d4786df78d1969c
    entity_id: d974ef70b7826371fc7d9a49a456a9f6
    domain: switch
  mode: single
- id: tende_ombreggiatura_balcone
  alias: Covers | Ombreggiatura Balcone (smart)
  triggers:
  - value_template: "{{ states('sensor.solar_radiation_sma')|float(0) >\n   states('input_number.tende_rad_min')|float(300)
      }}\n"
    for: 00:06:00
    trigger: template
  - value_template: "{{ states('sensor.solar_radiation_sma')|float(0) <\n   (states('input_number.tende_rad_min')|float(300)
      - 40) }}\n"
    for: 00:06:00
    trigger: template
  - minutes: /10
    trigger: time_pattern
  conditions:
  - condition: state
    entity_id: input_boolean.tende_automatiche
    state: 'on'
  actions:
  - choose:
    - conditions:
      - condition: or
        conditions:
        - condition: state
          entity_id: input_boolean.tende_blocco_vento
          state: 'on'
        - condition: state
          entity_id: input_boolean.tende_blocco_pioggia
          state: 'on'
      sequence:
      - variables:
          pos: 0
          cmd: '{{ 100 - pos }}'
      - target:
          entity_id:
          - cover.tenda_da_sole_camera_bambine_window_covering
          - cover.tenda_da_sole_studio_window_covering
          - cover.rolling_shutter_switch_3_window_covering
        data:
          position: '{{ cmd }}'
        action: cover.set_cover_position
    - conditions:
      - condition: state
        entity_id: input_boolean.tende_blocco_vento
        state: 'off'
      - condition: template
        value_template: '{% set elev = state_attr(''sun.sun'',''elevation'')|float(-90)
          %} {% set azi  = state_attr(''sun.sun'',''azimuth'')|float(0) %} {% set
          fac_min = 110 %} {% set fac_max = 260 %} {{ elev >= 5 and fac_min <= azi
          <= fac_max }}'
      sequence:
      - variables:
          pos: '{{ states(''sensor.tende_posizione_desiderata'')|int(0) }}'
          cmd: '{{ 100 - (states(''sensor.tende_posizione_desiderata'')|int(0)) }}'
          cur1_ext: '{{ 100 - (state_attr(''cover.tenda_da_sole_camera_bambine_window_covering'',''current_position'')|int(0))
            }}'
          cur2_ext: '{{ 100 - (state_attr(''cover.tenda_da_sole_studio_window_covering'',''current_position'')|int(0))
            }}'
          cur3_ext: '{{ 100 - (state_attr(''cover.tende_da_sole_salotto_window_covering'',''current_position'')|int(0))
            }}'
      - condition: template
        value_template: '{{ (pos - cur1_ext)|abs >= 7 or (pos - cur2_ext)|abs >= 7
          or (pos - cur3_ext)|abs >= 7 }}'
      - target:
          entity_id:
          - cover.tenda_da_sole_camera_bambine_window_covering
          - cover.tenda_da_sole_studio_window_covering
          - cover.rolling_shutter_switch_3_window_covering
        data:
          position: '{{ cmd }}'
        action: cover.set_cover_position
    default:
    - variables:
        pos: 0
        cmd: '{{ 100 - pos }}'
    - target:
        entity_id:
        - cover.tenda_da_sole_camera_bambine_window_covering
        - cover.tenda_da_sole_studio_window_covering
        - cover.rolling_shutter_switch_3_window_covering
      data:
        position: '{{ cmd }}'
      action: cover.set_cover_position
  mode: restart
- id: tende_sicurezza_vento_on
  alias: Covers | Sicurezza Vento | Ritrai e Blocca
  triggers:
  - entity_id: sensor.vento_gust_ms
    above: 12
    for: 00:00:20
    trigger: numeric_state
  - entity_id: sensor.vento_velocita_ms
    above: 8
    for: 00:00:30
    trigger: numeric_state
  actions:
  - target:
      entity_id: input_boolean.tende_blocco_vento
    action: input_boolean.turn_on
  - variables:
      pos: 0
      cmd: '{{ 100 - pos }}'
  - target:
      entity_id:
      - cover.tenda_da_sole_camera_bambine_window_covering
      - cover.tenda_da_sole_studio_window_covering
      - cover.rolling_shutter_switch_3_window_covering
    data:
      position: '{{ cmd }}'
    action: cover.set_cover_position
  - data:
      title: Vento forte
      message: Tende ritratte e blocco vento attivo.
      notification_id: tende_vento
    action: persistent_notification.create
  mode: single
- id: tende_sicurezza_vento_off
  alias: Covers | Sicurezza Vento | Sblocca dopo calma
  mode: single
  trigger:
  - platform: template
    value_template: "{{ states('sensor.vento_gust_ms')|float(99) < 10 and\n   states('sensor.vento_velocita_ms')|float(99)
      < 7 }}\n"
    for: 00:30:00
  condition:
  - condition: state
    entity_id: input_boolean.tende_blocco_vento
    state: 'on'
  action:
  - service: input_boolean.turn_off
    target:
      entity_id: input_boolean.tende_blocco_vento
  - service: persistent_notification.create
    data:
      title: Vento calmo
      message: 'Blocco vento rimosso: le automazioni possono riaprire le tende.'
      notification_id: tende_vento
- id: tende_override_on_manual
  alias: Covers | Override Manuale | Disattiva automatico 60'
  triggers:
  - event_type: call_service
    event_data:
      domain: cover
    trigger: event
  conditions:
  - condition: template
    value_template: '{% set s = trigger.event.data.service %} {{ s in [''open_cover'',''close_cover'',''set_cover_position'',''stop_cover'']
      }}

      '
  - condition: template
    value_template: '{{ trigger.event.context and trigger.event.context.user_id is
      not none }}

      '
  - condition: template
    value_template: "{% set ids = trigger.event.data.service_data.entity_id %} {%
      set idstr = ids if ids is string else (ids | join(',')) %} {{ \n  'cover.tenda_da_sole_camera_bambine_window_covering'
      in idstr or\n  'cover.tenda_da_sole_studio_window_covering' in idstr or\n  'cover.tende_da_sole_salotto_window_covering'
      in idstr\n}}\n"
  actions:
  - target:
      entity_id: input_boolean.tende_automatiche
    action: input_boolean.turn_off
    data: {}
  - action: timer.cancel
    data: {}
    target:
      entity_id: timer.tende_override_timer
  - action: timer.start
    data: {}
    target:
      entity_id: timer.tende_override_timer
  mode: restart
- id: tende_override_timer_finished
  alias: Covers | Override Manuale | Riattiva automatico
  triggers:
  - event_type: timer.finished
    event_data:
      entity_id: timer.tende_override
    trigger: event
  - trigger: state
    entity_id:
    - alarm_control_panel.allarme
    to: arming
  actions:
  - target:
      entity_id: input_boolean.tende_automatiche
    action: input_boolean.turn_on
    data: {}
  mode: single
- id: tende_sicurezza_pioggia_on
  alias: Covers | Sicurezza Pioggia | Ritrai e Blocca
  description: ''
  triggers:
  - entity_id:
    - sensor.ilegna18_precipitation_rate
    above: 1
    for:
      hours: 0
      minutes: 0
      seconds: 20
      milliseconds: 0
    trigger: numeric_state
  - entity_id:
    - sensor.ilegna18_precipitation_rate
    above: 0.3
    for:
      hours: 0
      minutes: 2
      seconds: 0
      milliseconds: 0
    trigger: numeric_state
  actions:
  - target:
      entity_id: input_boolean.tende_blocco_pioggia
    action: input_boolean.turn_on
    data: {}
  - variables:
      pos: 0
      cmd: '{{ 100 - pos }}'
  - target:
      entity_id:
      - cover.tenda_da_sole_camera_bambine_window_covering
      - cover.tenda_da_sole_studio_window_covering
      - cover.rolling_shutter_switch_3_window_covering
    data:
      position: '{{ cmd }}'
    action: cover.set_cover_position
  - data:
      title: Pioggia rilevata
      message: Tende ritratte e blocco pioggia attivo.
      notification_id: tende_pioggia
    action: persistent_notification.create
  mode: single
- id: tende_sicurezza_pioggia_off
  alias: Covers | Sicurezza Pioggia | Sblocca dopo asciutto
  triggers:
  - value_template: '{{ states(''sensor.ilegna18_precipitation_rate'')|float(99) <
      0.1 }}

      '
    for:
      hours: 0
      minutes: 20
      seconds: 0
      milliseconds: 0
    trigger: template
  conditions:
  - condition: state
    entity_id: input_boolean.tende_blocco_pioggia
    state: 'on'
  actions:
  - target:
      entity_id: input_boolean.tende_blocco_pioggia
    action: input_boolean.turn_off
    data: {}
  - data:
      title: Pioggia terminata
      message: 'Blocco pioggia rimosso: le automazioni possono riaprire le tende.'
      notification_id: tende_pioggia
    action: persistent_notification.create
  mode: single
- id: '1755679012938'
  alias: Condizionatore | Camera delle Bambine
  description: ''
  use_blueprint:
    path: custom/ac_room_controller.yaml
    input:
      climate_entity: climate.camera_delle_bambine_air_conditioner
      temp_sensor: sensor.camera_bambine_temperatura_media
      humidity_sensor: sensor.camera_bambine_umidita_media
      presence_entity: group.people
      setpoint_helper: input_number.setpoint_camera_bambine
      hysteresis_helper: input_number.hysteresis_camera_bambine
      night_offset_helper: input_number.night_offset_camera_bambine
      humidity_dry_threshold_helper: input_number.humidity_dry_threshold_camera_bambine
      night_start: '21:00:00'
      wfh_boolean: input_boolean.smartworking
      window_sensor: binary_sensor.finestra_camera_bambine
- id: '1755679098156'
  alias: Condizionatore | Studio
  description: ''
  use_blueprint:
    path: custom/ac_room_controller.yaml
    input:
      climate_entity: climate.studio_air_conditioner
      temp_sensor: sensor.studio_temperatura_media
      humidity_sensor: sensor.studio_umidita_media
      presence_entity: group.people
      setpoint_helper: input_number.setpoint_studio
      hysteresis_helper: input_number.hysteresis_studio
      night_offset_helper: input_number.night_offset_studio
      humidity_dry_threshold_helper: input_number.humidity_dry_threshold_studio
      wfh_boolean: input_boolean.smartworking
      window_sensor: binary_sensor.finestra_studio
- id: '1755679169638'
  alias: Condizionatore | Zona Giorno
  description: ''
  use_blueprint:
    path: custom/ac_room_controller.yaml
    input:
      climate_entity: climate.salotto_air_conditioner
      temp_sensor: sensor.zona_giorno_temperatura_media
      humidity_sensor: sensor.zona_giorno_umidita_media
      presence_entity: group.people
      setpoint_helper: input_number.setpoint_zona_giorno
      hysteresis_helper: input_number.hysteresis_zona_giorno
      night_offset_helper: input_number.night_offset_zona_giorno
      humidity_dry_threshold_helper: input_number.humidity_dry_threshold_zona_giorno
      wfh_boolean: input_boolean.smartworking
      window_sensor: binary_sensor.finestre_zona_giorno
- id: '1755679278564'
  alias: Condizionatore |  Camera Matrimoniale
  description: ''
  use_blueprint:
    path: custom/ac_room_controller.yaml
    input:
      climate_entity: climate.camera_matrimoniale_air_conditioner
      temp_sensor: sensor.camera_matrimoniale_temperatura_media
      humidity_sensor: sensor.camera_matrimoniale_umidita_media
      presence_entity: group.people
      setpoint_helper: input_number.setpoint_camera_matrimoniale
      hysteresis_helper: input_number.hysteresis_camera_matrimoniale
      night_offset_helper: input_number.night_offset_camera_matrimoniale
      humidity_dry_threshold_helper: input_number.humidity_dry_threshold_camera_matrimoniale
      wfh_boolean: input_boolean.smartworking
      window_sensor: binary_sensor.finestra_camera_da_letto
